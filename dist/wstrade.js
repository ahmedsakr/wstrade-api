!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("node-fetch"),require("http-status")):"function"==typeof define&&define.amd?define(["node-fetch","http-status"],t):"object"==typeof exports?exports["wstrade-api"]=t(require("node-fetch"),require("http-status")):e["wstrade-api"]=t(e._,e._)}(global,(function(e,t){return(()=>{var s={393:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var r=s(170),a=s(263);const i={all:async()=>{let e=await(0,a.X)(r.Z.ACCOUNT_IDS,{});return{tfsa:e.find((e=>e.startsWith("tfsa"))),rrsp:e.find((e=>e.startsWith("rrsp"))),crypto:e.find((e=>e.startsWith("non-registered-crypto"))),personal:e.find((e=>e.startsWith("non-registered")&&!e.startsWith("non-registered-crypto")))}},data:async()=>(0,a.X)(r.Z.LIST_ACCOUNT,{}),me:async()=>(0,a.X)(r.Z.ME,{}),person:async()=>(0,a.X)(r.Z.PERSON,{}),history:async(e,t)=>(0,a.X)(r.Z.HISTORY_ACCOUNT,{interval:e,accountId:t}),activities:async()=>(0,a.X)(r.Z.ACTIVITIES,{}),getBankAccounts:async()=>(0,a.X)(r.Z.BANK_ACCOUNTS,{}),deposits:async()=>(0,a.X)(r.Z.DEPOSITS,{}),positions:async e=>(0,a.X)(r.Z.POSITIONS,{accountId:e})}},170:(e,t,s)=>{"use strict";s.d(t,{p:()=>i,Z:()=>o});var r=s(496),a=s(696);const i=20,n={onFailure:async e=>({status:e.status,reason:e.statusText,body:await e.json()}),onSuccess:async e=>await e.response.json()},o={LOGIN:{method:"POST",url:"https://trade-service.wealthsimple.com/auth/login",onSuccess:async e=>({tokens:{access:e.response.headers.get("x-access-token"),refresh:e.response.headers.get("x-refresh-token"),expires:parseInt(e.response.headers.get("x-access-token-expires"))},accountInfo:await e.response.json()}),onFailure:n.onFailure},REFRESH:{method:"POST",url:"https://trade-service.wealthsimple.com/auth/refresh",onSuccess:async e=>({tokens:{access:e.response.headers.get("x-access-token"),refresh:e.response.headers.get("x-refresh-token"),expires:parseInt(e.response.headers.get("x-access-token-expires"))}}),onFailure:n.onFailure},ACCOUNT_IDS:{method:"GET",url:"https://trade-service.wealthsimple.com/account/list",onSuccess:async e=>(await e.response.json()).results.map((e=>e.id)),onFailure:n.onFailure},LIST_ACCOUNT:{method:"GET",url:"https://trade-service.wealthsimple.com/account/list",onSuccess:n.onSuccess,onFailure:n.onFailure},ME:{method:"GET",url:"https://trade-service.wealthsimple.com/me",onSuccess:n.onSuccess,onFailure:n.onFailure},PERSON:{method:"GET",url:"https://trade-service.wealthsimple.com/person",onSuccess:n.onSuccess,onFailure:n.onFailure},HISTORY_ACCOUNT:{method:"GET",url:"https://trade-service.wealthsimple.com/account/history/{0}?account_id={1}",parameters:{0:"interval",1:"accountId"},onSuccess:n.onSuccess,onFailure:n.onFailure},ACTIVITIES:{method:"GET",url:"https://trade-service.wealthsimple.com/account/activities",onSuccess:async e=>(await e.response.json()).results,onFailure:n.onFailure},DEPOSITS:{method:"GET",url:"https://trade-service.wealthsimple.com/deposits",onSuccess:async e=>(await e.response.json()).results,onFailure:n.onFailure},BANK_ACCOUNTS:{method:"GET",url:"https://trade-service.wealthsimple.com/bank-accounts",onSuccess:async e=>(await e.response.json()).results,onFailure:n.onFailure},EXCHANGE_RATES:{method:"GET",url:"https://trade-service.wealthsimple.com/forex",onSuccess:n.onSuccess,onFailure:n.onFailure},SECURITY:{method:"GET",url:"https://trade-service.wealthsimple.com/securities?query={0}",parameters:{0:"ticker"},onSuccess:async e=>{let t=await e.response.json();return 0===t.results.length?Promise.reject({reason:"Security does not exist"}):t.results},onFailure:n.onFailure},EXTENSIVE_SECURITY_DETAILS:{method:"GET",url:"https://trade-service.wealthsimple.com/securities/{0}",parameters:{0:"id"},onSuccess:async e=>await e.response.json(),onFailure:n.onFailure},POSITIONS:{method:"GET",url:"https://trade-service.wealthsimple.com/account/positions?account_id={0}",parameters:{0:"accountId"},onSuccess:async e=>(await e.response.json()).results,onFailure:n.onFailure},ORDERS_BY_PAGE:{method:"GET",url:"https://trade-service.wealthsimple.com/orders?offset={0}&account_id={1}",parameters:{0:"offset",1:"accountId"},onSuccess:async e=>{const t=await e.response.json();return{total:t.total,orders:t.results}},onFailure:n.onFailure},ALL_ORDERS:{method:"GET",url:"https://trade-service.wealthsimple.com/orders?account_id={0}",parameters:{0:"accountId"},onSuccess:async e=>{const t=await e.response.json(),s=Math.ceil(t.total/i);let r=t.results;if(s>1)for(let t=2;t<=s;t++){let s=await a.Z.page(e.arguments.accountId,t);r.push(...s.orders)}return{total:r.length,orders:r}},onFailure:n.onFailure},FILTERED_ORDERS:{method:"GET",url:"https://trade-service.wealthsimple.com/orders?account_id={0}",parameters:{0:"accountId"},onSuccess:async e=>{const t=await e.response.json(),s=Math.ceil(t.total/i);let n=t=>{let s=e.arguments.ticker;if(s){let e=new r.Z({symbol:t.symbol,id:t.security_id});if(!s.weakEquals(e))return!1}return t.status===e.arguments.status},o=t.results.filter(n);if(s>1)for(let t=2;t<=s;t++){let s=await a.Z.page(e.arguments.accountId,t);o.push(...s.orders.filter(n))}return{total:o.length,orders:o}},onFailure:n.onFailure},CANCEL_ORDER:{method:"DELETE",url:"https://trade-service.wealthsimple.com/orders/{0}",parameters:{0:"orderId"},onSuccess:async e=>({order:e.arguments.orderId,response:await e.response.json()}),onFailure:n.onFailure},PLACE_ORDER:{method:"POST",url:"https://trade-service.wealthsimple.com/orders",onSuccess:n.onSuccess,onFailure:n.onFailure}}},648:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var r=s(263),a=s(170);const i={tokens:null,otp:null,on:function(e,t){this[e]=t},login:async function(e,t){let s=null;"function"==typeof this.otp&&await(0,r.X)(a.Z.LOGIN,{email:e,password:t}).catch((()=>{}));try{s=await(0,r.X)(a.Z.LOGIN,{email:e,password:t,otp:"function"==typeof this.otp?await this.otp():this.otp})}catch(e){if(!this.otp)return Promise.reject("OTP not provided!");throw e}this.tokens=s.tokens},refresh:async function(){this.tokens.access=null;let e=await(0,r.X)(a.Z.REFRESH,{refresh_token:this.tokens.refresh});this.tokens=e.tokens}}},182:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a,p:()=>i});let r=[];function a(e){if(e?.startsWith("no_")){let t=e.substring(e.indexOf("_")+1);i(t)||r.push(t)}else i(e)&&r.splice(r.indexOf(e),1)}const i=e=>r.includes(e)},496:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});const r=["NASDAQ","NYSE","TSX","TSX-V"],a=class{constructor(e){if(this.symbol=null,this.exchange=null,this.id=null,"string"==typeof e){let t=e.split(":");this.symbol=t[0],this.exchange=t[1]}else{if(!e.hasOwnProperty("symbol")&&!e.hasOwnProperty("id"))throw new Error(`Invalid ticker '${e}'`);this.symbol=e.symbol,this.exchange=e.exchange,this.id=e.id}if(this.exchange&&!r.includes(this.exchange))throw new Error(`Invalid exchange '${this.exchange}'!`)}format(){return this.id?this.id:`${this.symbol}${this.exchange?":"+this.exchange:""}`}weakEquals(e){return this.id===e.id||this.symbol===e.symbol}}},471:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});var r=s(170),a=s(263),i=s(496);const n={exchangeRates:async()=>(0,a.X)(r.Z.EXCHANGE_RATES,{}),getSecurity:async(e,t)=>{if((e=new i.Z(e)).id)return(0,a.X)(r.Z.EXTENSIVE_SECURITY_DETAILS,{id:e.id});let s=await(0,a.X)(r.Z.SECURITY,{ticker:e.symbol});return s=s.filter((t=>t.stock.symbol===e.symbol)),e.exchange&&(s=s.filter((t=>t.stock.primary_exchange===e.exchange))),s.length>1?Promise.reject({reason:"Multiple securities matched query."}):0===s.length?Promise.reject({reason:"No securities matched query."}):t?(0,a.X)(r.Z.EXTENSIVE_SECURITY_DETAILS,{id:s[0].id}):s[0]}}},383:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let r=new(s(545).Headers);const a={add:(e,t)=>r.append(e,t),remove:e=>r.delete(e),clear:()=>[...r].forEach((e=>r.delete(e[0]))),values:()=>[...r]}},138:(e,t,s)=>{const r=s(648).Z,a=s(383).Z,i=s(393).Z,n=s(696).Z,o=s(471).Z,c=s(307).Z,u=s(182).Z;e.exports={auth:r,headers:a,accounts:i,orders:n,quotes:c,data:o,config:u}},263:(e,t,s)=>{"use strict";s.d(t,{X:()=>l});var r=s(545),a=s.n(r),i=s(457),n=s.n(i),o=s(383),c=s(648),u=s(182);async function l(e,t){try{const s=await async function(e,t){let s=new(a().Headers);s.append("Content-Type","application/json"),await async function(){if(!c.Z.tokens.access)return!0;if((0,u.p)("implicit_token_refresh"))return!0;if(parseInt(Date.now()/1e3)>=c.Z.tokens.expires){if(!c.Z.tokens.refresh)return Promise.reject("Access token expired");try{await c.Z.refresh()}catch(e){return Promise.reject("Unable to refresh expired token: "+e)}}return!0}()&&s.append("Authorization",c.Z.tokens.access),o.Z.values().forEach((e=>s.append(...e)));let{url:r,payload:i}=function(e,t){t=Object.assign({},t);let s=e.url;if(e.parameters)for(let r=0;r<Object.keys(e.parameters).length;r++){if(null===t[e.parameters[r]]||void 0===t[e.parameters[r]])throw new Error("URL Path parameter missing");s=s.replace(`{${r}}`,t[e.parameters[r]]),delete t[e.parameters[r]]}return["GET","HEAD"].includes(e.method)?{url:s,payload:void 0}:{url:s,payload:JSON.stringify(t)}}(e,t);return a()(r,{body:i,method:e.method,headers:s})}(e,t);return[n().OK,n().CREATED].includes(s.status)?e.onSuccess({arguments:t,response:s}):Promise.reject(await e.onFailure(s))}catch(e){throw e}}},696:(e,t,s)=>{"use strict";s.d(t,{Z:()=>p});var r=s(170),a=s(263),i=s(496);const n=async(e,t,s)=>(0,a.X)(r.Z.FILTERED_ORDERS,{accountId:e,ticker:t?new i.Z(t):void 0,status:s}),o={page:async(e,t)=>(0,a.X)(r.Z.ORDERS_BY_PAGE,{offset:(t-1)*r.p,accountId:e}),all:async e=>(0,a.X)(r.Z.ALL_ORDERS,{offset:0,accountId:e}),pending:async(e,t)=>n(e,t,"submitted"),filled:async(e,t)=>n(e,t,"posted"),cancelled:async(e,t)=>n(e,t,"cancelled")};var c=s(471),u=s(307);const l=e=>["TSX","TSX-V"].includes(e),d={cancel:async e=>(0,a.X)(r.Z.CANCEL_ORDER,{orderId:e}),cancelPending:async function(e){const t=await o.pending(e);return Promise.all(t.orders.map((async e=>await this.cancel(e.order_id))))},marketBuy:async(e,t,s)=>{let i=await c.Z.getSecurity(t,!0);return(0,a.X)(r.Z.PLACE_ORDER,{security_id:i.id,limit_price:await u.Z.get(t),quantity:s,order_type:"buy_quantity",order_sub_type:"market",time_in_force:"day",account_id:e})},limitBuy:async(e,t,s,i)=>(0,a.X)(r.Z.PLACE_ORDER,{security_id:(await c.Z.getSecurity(t)).id,limit_price:s,quantity:i,order_type:"buy_quantity",order_sub_type:"limit",time_in_force:"day",account_id:e}),stopLimitBuy:async(e,t,s,i,n)=>{let o=await c.Z.getSecurity(t);return l(o.stock.primary_exchange)&&s!==i?Promise.reject({reason:"TSX/TSX-V securities must have an equivalent stop and limit price."}):(0,a.X)(r.Z.PLACE_ORDER,{security_id:o.id,stop_price:s,limit_price:i,quantity:n,order_type:"buy_quantity",order_sub_type:"stop_limit",time_in_force:"day",account_id:e})},marketSell:async(e,t,s)=>{let i=await c.Z.getSecurity(t,!0);return(0,a.X)(r.Z.PLACE_ORDER,{security_id:i.id,market_value:await u.Z.get(t),quantity:s,order_type:"sell_quantity",order_sub_type:"market",time_in_force:"day",account_id:e})},limitSell:async(e,t,s,i)=>(0,a.X)(r.Z.PLACE_ORDER,{security_id:(await c.Z.getSecurity(t)).id,limit_price:s,quantity:i,order_type:"sell_quantity",order_sub_type:"limit",time_in_force:"day",account_id:e}),stopLimitSell:async(e,t,s,i,n)=>{let o=await c.Z.getSecurity(t);return l(o.stock.primary_exchange)&&s!==i?Promise.reject({reason:"TSX/TSX-V securities must have an equivalent stop and limit price."}):(0,a.X)(r.Z.PLACE_ORDER,{security_id:o.id,stop_price:s,limit_price:i,quantity:n,order_type:"sell_quantity",order_sub_type:"stop_limit",time_in_force:"day",account_id:e})}},p={...o,...d}},307:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(471);const a={defaultProvider:{quote:async e=>(await r.Z.getSecurity(e,!0)).quote.amount},providers:{},use:function(e,t){if("function"!=typeof t.quote)throw new Error(`Invalid quote provider for ${e}!`);this.providers[e]=t},get:async function(e){let t=null;return e.exchange?t=e.exchange:Object.keys(this.providers).length>0&&(t=(await r.Z.getSecurity(e,!1)).stock.primary_exchange),this.providers.hasOwnProperty(t)?this.providers[t].quote(e):this.defaultProvider.quote(e)}}},457:e=>{"use strict";e.exports=t},545:t=>{"use strict";t.exports=e}},r={};function a(e){if(r[e])return r[e].exports;var t=r[e]={exports:{}};return s[e](t,t.exports,a),t.exports}return a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a(138)})()}));